[AxForm]
Version=1
Size=362, 118
Title=%Stitch Setup%

[AXControls]
Name=edtOverlapX
ProgID=VTCONTROLS.VTEditor.1
Rect=17, 22, 166, 44
Style=50000000h
ID=5301
Data=245 00 00 01 00 09 00 00 00 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 de 82 00 b0 de 82 00 00 00 00 00 00 00 00 00 7c 62 73 81 0c 00 60 00 90 05 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 de 82 00 b0 de 82 00 00 00 00 00 00 00 00 00 7c 62 73 81 0c 00 60 00 90 05 08 56 54 45 64 69 74 6f 72 01 00 11 20 20 20 20 20 58 20 6f 76 65 72 6c 61 79 2c 20 25 01 00 00 00 01 00 02 31 30 66 00 01 00 00 00 01 00 00 00 00 00 44 42 00 00 80 3f 08 00 00 80 05 00 00 80 08 00 00 80 0f 00 00 80 0f 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

Name=edtOverlapY
ProgID=VTCONTROLS.VTEditor.1
Rect=17, 49, 166, 71
Style=50000000h
ID=5302
Data=245 00 00 01 00 09 00 00 00 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 00 00 00 3d c7 00 78 70 08 00 00 ff ff ff ff b1 12 00 78 e0 b9 a0 00 90 05 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 e6 82 00 bc e6 82 00 00 00 00 00 00 00 00 00 7c 62 73 81 0c 00 60 00 90 05 08 56 54 45 64 69 74 6f 72 01 00 11 20 20 20 20 20 59 20 6f 76 65 72 6c 61 79 2c 20 25 01 00 00 00 01 00 02 31 30 66 00 01 00 00 00 01 00 00 00 00 00 44 42 00 00 80 3f 08 00 00 80 05 00 00 80 08 00 00 80 0f 00 00 80 0f 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

Name=frmHorBorder
ProgID=VTDESIGN.VTD3DBarCtrl.1
Rect=6, 14, 174, 108
Style=58000000h
ID=123
Data=73 00 00 00 00 03 00 00 00 03 00 02 00 00 00 05 00 00 80 01 00 00 00 08 00 00 80 00 64 00 00 00 00 00 01 00 01 00 00 00 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 bc 02 44 42 01 00 06 54 61 68 6f 6d 61

Name=edtOverlapYV
ProgID=VTCONTROLS.VTEditor.1
Rect=197, 49, 346, 71
Style=50000000h
ID=5304
Data=245 00 00 01 00 09 00 00 00 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 00 00 00 3d c7 00 78 70 08 00 00 ff ff ff ff b1 12 00 78 f0 a9 a0 00 90 05 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 e6 82 00 bc e6 82 00 00 00 00 00 00 00 00 00 7c 62 73 81 0c 00 60 00 90 05 08 56 54 45 64 69 74 6f 72 01 00 11 20 20 20 20 20 59 20 6f 76 65 72 6c 61 79 2c 20 25 01 00 00 00 01 00 02 31 30 66 00 01 00 00 00 01 00 00 00 00 00 44 42 00 00 80 3f 08 00 00 80 05 00 00 80 08 00 00 80 0f 00 00 80 0f 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

Name=chkV
ProgID=VTCHECKBOX.VTCheckBoxCtrl.1
Rect=197, 79, 298, 97
Style=50000000h
ID=123
Data=107 00 00 00 00 04 00 00 00 00 00 00 00 04 53 68 6f 77 08 00 00 80 0f 00 00 80 08 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 90 01 44 42 01 00 06 54 61 68 6f 6d 61

Name=chkH
ProgID=VTCHECKBOX.VTCheckBoxCtrl.1
Rect=17, 79, 118, 97
Style=50000000h
ID=123
Data=107 00 00 00 00 04 00 00 00 00 00 00 00 04 53 68 6f 77 08 00 00 80 0f 00 00 80 08 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 90 01 44 42 01 00 06 54 61 68 6f 6d 61

Name=frmVertBorder
ProgID=VTDESIGN.VTD3DBarCtrl.1
Rect=184, 14, 352, 108
Style=58000000h
ID=123
Data=73 00 00 00 00 03 00 00 00 03 00 02 00 00 00 05 00 00 80 01 00 00 00 08 00 00 80 00 64 00 00 00 00 00 01 00 01 00 00 00 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 bc 02 44 42 01 00 06 54 61 68 6f 6d 61

Name=edtOverlapXV
ProgID=VTCONTROLS.VTEditor.1
Rect=197, 22, 346, 44
Style=50000000h
ID=5303
Data=245 00 00 01 00 09 00 00 00 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 00 00 00 3d c7 00 78 70 08 00 00 ff ff ff ff b1 12 00 78 b0 bd a0 00 90 05 f5 ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 90 01 00 00 00 00 00 00 00 00 00 00 54 61 68 6f 6d 61 00 e6 82 00 bc e6 82 00 00 00 00 00 00 00 00 00 7c 62 73 81 0c 00 60 00 90 05 08 56 54 45 64 69 74 6f 72 01 00 11 20 20 20 20 20 58 20 6f 76 65 72 6c 61 79 2c 20 25 01 00 00 00 01 00 02 31 30 66 00 01 00 00 00 01 00 00 00 00 00 44 42 00 00 80 3f 08 00 00 80 05 00 00 80 08 00 00 80 0f 00 00 80 0f 00 00 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

Name=frmHor
ProgID=VTCONTROLS.VTStaticText.1
Rect=11, 1, 165, 14
Style=50000000h
ID=0
Data=325 05 00 00 00 0f 00 00 80 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 bc 02 44 42 01 00 06 54 61 68 6f 6d 61 0a 00 00 00 08 00 00 80 0f 00 00 80 0f 00 00 80 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 11 48 6f 72 69 7a 6f 6e 74 61 6c 20 53 74 69 74 63 68 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00 00 00 00 00 49 4c 01 01 00 00 02 00 04 00 01 00 01 00 ff ff ff ff 11 00 ff ff ff ff ff ff ff ff 42 4d 36 00 00 00 00 00 00 00 36 00 00 00 28 00 00 00 04 00 00 00 01 00 00 00 01 00 10 00 00 00 00 00 08 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 34 e0 ce 81 0c 90 ce 81 42 4d 3e 00 00 00 00 00 00 00 3e 00 00 00 28 00 00 00 04 00 00 00 01 00 00 00 01 00 01 00 00 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ff 00 60 00 00 00 01 00 00 00 01 00 00 00 0f 00 00 80 00 00 00 00

Name=frmVert
ProgID=VTCONTROLS.VTStaticText.1
Rect=190, 1, 342, 14
Style=50000000h
ID=0
Data=323 05 00 00 00 0f 00 00 80 00 03 52 e3 0b 91 8f ce 11 9d e3 00 aa 00 4b b8 51 01 00 00 00 bc 02 44 42 01 00 06 54 61 68 6f 6d 61 0a 00 00 00 08 00 00 80 0f 00 00 80 0f 00 00 80 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0f 56 65 72 74 69 63 61 6c 20 53 74 69 74 63 68 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00 00 00 00 00 49 4c 01 01 00 00 02 00 04 00 01 00 01 00 ff ff ff ff 11 00 ff ff ff ff ff ff ff ff 42 4d 36 00 00 00 00 00 00 00 36 00 00 00 28 00 00 00 04 00 00 00 01 00 00 00 01 00 10 00 00 00 00 00 08 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 14 49 cf 81 0c 90 ce 81 42 4d 3e 00 00 00 00 00 00 00 3e 00 00 00 28 00 00 00 04 00 00 00 01 00 00 00 01 00 01 00 00 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ff 00 60 00 00 00 01 00 00 00 01 00 00 00 0f 00 00 80 00 00 00 00


[Script]
Form.Title = Docs.LoadString ("Stitch Setup")

Dim	global, X,Y,rec,MaxHOvrX,MaxHOvrY,MaxVOvrX,MaxVOvrY,img
Dim VizirObj
Dim VizirObjName
Set global = Application.GetGlobalScript("")
Data.SetValue "\Editor\CommentText_DrawArrow",0
Form.UpdateSystemSettings
VizirObjName = "_1"

'***************************************************************
'Form event handlers.
'***************************************************************
Sub Form_OnShow()
	'Place here your event handler.
End Sub
Sub Form_OnInitialize()
	set o = Objects.ActiveImage
	If not Docs.IsPointerNull(o.GetParent) Then 		
		Objects.RemoveObject o	' отселектить рамку
	End If
	set o = Nothing
	Set img = Objects.ActiveImage
	X = img.GetWidth
	Y = img.GetHeight
	frmHor.Text = Docs.LoadString ("Horizontal Stitch")
	frmVert.Text = Docs.LoadString ("Vertical Stitch")
	edtOverlapX.CaptionText = Docs.LoadString ("X overlay, %")
	edtOverlapXV.CaptionText = Docs.LoadString ("X overlay, %")
	edtOverlapY.CaptionText = Docs.LoadString ("Y overlay, %")
	edtOverlapYV.CaptionText = Docs.LoadString ("Y overlay, %")
	chkH.Caption = Docs.LoadString ("Show")
	chkV.Caption = Docs.LoadString ("Show")

	ActionManager.HideDockBars 
	ActionManager.ObjectNew "Drawing Object List",VizirObjName
	Set VizirObj = Objects.GetObjectByName( VizirObjName )

	ActionState.SetActionState "ShowSource", 0
	ActionState.SetActionState "ShowImage", 0
	ActionState.SetActionState "ShowMasks", 0
	ActionState.SetActionState "ShowObjects", 0
	ActionState.SetActionState "ShowBinaryFore", 0
	ActionState.SetActionState "ShowBinaryBack", 0
	ActionState.SetActionState "ShowMeasView", 0
	ActionState.SetActionState "ShowStatView", 0
	ActionState.SetActionState "ShowStatTable", 0
	'ActionState.SetActionState "ShowPropertyBar", 0
	ActionState.SetActionState "SendTo", 0

	ActionState.BeginGroupUndo "qq"

	global.UnSplit()
	rec = 1
	MaxHOvrX = Data.GetValue ("\Sew\MaxHOvrX")*100
	If MaxHOvrX > 49 Then MaxHOvrX = 49
	MaxHOvrY = Data.GetValue ("\Sew\MaxHOvrY")*100
	If MaxHOvrY > 49 Then MaxHOvrY = 49
	edtOverlapX.ValueInt = MaxHOvrX
	edtOverlapY.ValueInt = MaxHOvrY

	MaxVOvrX = Data.GetValue ("\Sew\MaxVOvrX")*100
	If MaxVOvrX > 49 Then MaxVOvrX = 49
	MaxVOvrY = Data.GetValue ("\Sew\MaxVOvrY")*100
	If MaxVOvrY > 49 Then MaxVOvrY = 49

	edtOverlapX.ValueInt = MaxHOvrX
	edtOverlapY.ValueInt = MaxHOvrY
	edtOverlapXV.ValueInt = MaxVOvrX
	edtOverlapYV.ValueInt = MaxVOvrY

	chkH.Checked 1
	'CheckHorVert("H")
	FitDoc2Screen
	Data.Setvalue "\ImageView\EnableDrawingSelection" ,0
	MainWnd.UpdateSystemSettings
	

	Data.SetValue "\ImageView\EnableDrawingDrag",0
	Draw()
	rec = 0
End Sub

Sub Form_OnOK()	
	Data.SetValue "\Sew\MaxHOvrX",edtOverlapX.ValueInt * 0.01
	Data.SetValue "\Sew\MinHOvrX",0.001
	Data.SetValue "\Sew\MaxHOvrY",edtOverlapY.ValueInt * 0.01
	Data.SetValue "\Sew\MinHOvrY",-edtOverlapY.ValueInt * 0.01

	Data.SetValue "\Sew\MaxVOvrX",edtOverlapXV.ValueInt * 0.01
	Data.SetValue "\Sew\MinVOvrX",-edtOverlapXV.ValueInt * 0.01
	Data.SetValue "\Sew\MaxVOvrY",edtOverlapYV.ValueInt * 0.01
	Data.SetValue "\Sew\MinVOvrY",0.001
End Sub
Sub Form_OnDestroy()
	Set DrwObj = Objects.GetActiveObject("Drawing Object List")
	Objects.RemoveObject DrwObj
	Set img = Nothing
	Set DrwObj = Nothing
	Set VizirObj = Nothing
	Data.SetValue "\ImageView\EnableDrawingDrag",1
	ActionManager.ShowDockBars 
	Data.Setvalue "\ImageView\EnableDrawingSelection" ,1
	MainWnd.UpdateSystemSettings
	Set global = Nothing

	ActionState.ResetActionState "ShowSource"
	ActionState.ResetActionState "ShowImage"
	ActionState.ResetActionState "ShowMasks"
	ActionState.ResetActionState "ShowObjects"
	ActionState.ResetActionState "ShowBinaryFore"
	ActionState.ResetActionState "ShowBinaryBack"
	ActionState.ResetActionState "ShowMeasView"
	ActionState.ResetActionState "ShowStatView"
	ActionState.ResetActionState "ShowStatTable"
	'ActionState.ResetActionState "ShowPropertyBar"
	ActionState.ResetActionState "SendTo"
	ActionState.EndGroupUndo 1
End Sub

Sub Draw()
	Set VizirObj = Objects.GetObjectByName( VizirObjName )
	Objects.RemoveObject VizirObj
	Set VizirObj = Nothing
	ActionManager.ObjectNew "Drawing Object List",VizirObjName
	Set VizirObj = Objects.GetObjectByName( VizirObjName )
	Objects.SetObjectActive VizirObj

	
	If chkH.Checked Then
		x1 = X*(edtOverlapX.ValueInt/100)
		y1 = Y*(edtOverlapY.ValueInt/100)
	
		ActionManager.Comment x1,  0,x1,  Y,-1,""
		ActionManager.Comment X-x1,0,X-x1,Y,-1,""
		ActionManager.Comment 0,y1,  X,y1,-1,""
		ActionManager.Comment 0,Y-y1,X,Y-y1,-1,""	
	Else	
		x1 = X*(edtOverlapXV.ValueInt/100)
		y1 = Y*(edtOverlapYV.ValueInt/100)
	
		ActionManager.Comment x1,  0,x1,  Y,-1,""
		ActionManager.Comment X-x1,0,X-x1,Y,-1,""
		ActionManager.Comment 0,y1,  X,y1,-1,""
		ActionManager.Comment 0,Y-y1,X,Y-y1,-1,""	
	End If
		ActionManager.DataUnselect	
	
	ActionManager.DataUnselect	
End Sub

'***************************************************************
'edtOverlapX event handlers.
'***************************************************************
Sub edtOverlapX_DataChange()
	If rec Then Exit Sub
	CheckHorVert("H")
	If edtOverlapX.ValueInt > edtOverlapX.MaxValue Then edtOverlapX.ValueInt = edtOverlapX.MaxValue 
	MaxHOvrX = X * edtOverlapX.ValueInt / 100
	Draw()
	edtOverlapX.SetFocus()
End Sub
'***************************************************************
'edtOverlapY event handlers.
'***************************************************************
Sub edtOverlapY_DataChange()
	If rec Then Exit Sub
	CheckHorVert("H")
	If edtOverlapY.ValueInt > edtOverlapY.MaxValue Then edtOverlapY.ValueInt = edtOverlapY.MaxValue 
	MaxHOvrY = Y * edtOverlapY.ValueInt / 100
	Draw()
	edtOverlapY.SetFocus()
End Sub

'***************************************************************
'MaxHOvrX event handlers.
'***************************************************************
Sub MaxHOvrX_DataChange()
	If MaxHOvrX/X*100 > 49 Then MaxHOvrX = X * 0.49
	edtOverlapX.ValueInt = MaxHOvrX/X*100
	Draw()
End Sub
'***************************************************************
'MaxHOvrY event handlers.
'***************************************************************
Sub MaxHOvrY_DataChange()
	If MaxHOvrY/Y*100 > 49 Then MaxHOvrY = Y * 0.49
	edtOverlapY.ValueInt = MaxHOvrY/Y*100	
	Draw()
End Sub
Sub CheckHorVert(param)
	rec = 1 
	If param="V" Then 
		chkH.Checked 0
		chkV.Checked 1
	End If
	If param="H" Then 
		chkV.Checked 0
		chkH.Checked 1		
	End If
	rec = 0
End Sub
'***************************************************************
'chkH event handlers.
'***************************************************************
Sub chkH_OnCheck(nCheck)
	If rec Then Exit Sub
	If nCheck Then 
		CheckHorVert("H")
	Else
		CheckHorVert("V")
	End If
	Draw()
End Sub
'***************************************************************
'chkV event handlers.
'***************************************************************
Sub chkV_OnCheck(nCheck)
	If rec Then Exit Sub
	If nCheck Then 
		CheckHorVert("V")
	Else
		CheckHorVert("H")
	End If
	Draw()
End Sub

'***************************************************************
'edtOverlapXV event handlers.
'***************************************************************
Sub edtOverlapXV_DataChange()
	If rec Then Exit Sub
	CheckHorVert("V")	
	If edtOverlapXV.ValueInt > edtOverlapXV.MaxValue Then edtOverlapXV.ValueInt = edtOverlapXV.MaxValue 
	MaxVOvrX = X * edtOverlapXV.ValueInt / 100
	Draw()
	edtOverlapXV.SetFocus()
End Sub
'***************************************************************
'edtOverlapYV event handlers.
'***************************************************************
Sub edtOverlapYV_DataChange()
	If rec Then Exit Sub
	CheckHorVert("V")
	If edtOverlapYV.ValueInt > edtOverlapYV.MaxValue Then edtOverlapYV.ValueInt = edtOverlapYV.MaxValue 
	MaxVOvrY = Y * edtOverlapYV.ValueInt / 100
	Draw()
	edtOverlapYV.SetFocus()
End Sub
'***************************************************************
'MaxVOvrX event handlers.
'***************************************************************
Sub MaxVOvrX_DataChange()
	If MaxVOvrX/Y*100 > 49 Then MaxVOvrX = X * 0.49
	edtOverlapXV.ValueInt = MaxVOvrX/X*100	
	Draw()
End Sub
'***************************************************************
'MaxVOvrY event handlers.
'***************************************************************
Sub MaxVOvrY_DataChange()
	If MaxVOvrY/Y*100 > 49 Then MaxVOvrY = Y * 0.49
	edtOverlapYV.ValueInt = MaxVOvrY/Y*100	
	Draw()
End Sub



















